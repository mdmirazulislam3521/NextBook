<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NextBook</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, textarea { width: 100%; margin: 5px 0; padding: 8px; }
    button { padding: 8px 15px; margin: 5px 0; }
    .post { border: 1px solid #ccc; padding: 10px; margin-top: 10px; }
  </style>
</head>

<body>

<h2>NextBook Login</h2>

<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">

<button onclick="signup()">Sign Up</button>
<button onclick="login()">Login</button>
<button onclick="logout()">Logout</button>

<p id="msg"></p>

<hr>

<h3>Create Post</h3>
<textarea id="postText" placeholder="Write something..."></textarea>
<button onclick="addPost()">Post</button>

<h3>All Posts</h3>
<div id="posts"></div>

<!-- ðŸ”¥ Firebase All-in-One Script -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  deleteDoc,
  doc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ”‘ Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyDYPJ4xZ8wx3KL7aVbji9A9KUWOYozKW-k",
  authDomain: "nextbook-78b81.firebaseapp.com",
  projectId: "nextbook-78b81",
  storageBucket: "nextbook-78b81.appspot.com",
  messagingSenderId: "1022007364860",
  appId: "1:1022007364860:web:884e9d153221494e575b79"
};

/* Init */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ðŸ” AUTH */
window.signup = async () => {
  const email = emailInput();
  const password = passwordInput();
  await createUserWithEmailAndPassword(auth, email, password);
  msg("Signup success");
};

window.login = async () => {
  const email = emailInput();
  const password = passwordInput();
  await signInWithEmailAndPassword(auth, email, password);
  msg("Login success");
};

window.logout = async () => {
  await signOut(auth);
  msg("Logged out");
};

/* ðŸ“ POSTS */
window.addPost = async () => {
  if (!auth.currentUser) return alert("Login first");

  const text = document.getElementById("postText").value;
  if (!text) return;

  await addDoc(collection(db, "posts"), {
    text,
    uid: auth.currentUser.uid,
    time: serverTimestamp()
  });

  document.getElementById("postText").value = "";
  loadPosts();
};

window.deletePost = async (id) => {
  await deleteDoc(doc(db, "posts", id));
  loadPosts();
};

async function loadPosts() {
  const box = document.getElementById("posts");
  box.innerHTML = "";

  const snap = await getDocs(collection(db, "posts"));
  snap.forEach(d => {
    box.innerHTML += `
      <div class="post">
        <p>${d.data().text}</p>
        <button onclick="deletePost('${d.id}')">Delete</button>
      </div>
    `;
  });
}

/* Helpers */
function msg(t){ document.getElementById("msg").innerText = t; }
function emailInput(){ return document.getElementById("email").value; }
function passwordInput(){ return document.getElementById("password").value; }

onAuthStateChanged(auth, loadPosts);

</script>

</body>
</html>
