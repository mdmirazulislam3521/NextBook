<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>NextBook</title>
</head>
<body>

<h2>NextBook</h2>

<h3>Signup</h3>
<input id="signupEmail" placeholder="Email">
<input id="signupPassword" type="password">
<button onclick="signup()">Create Account</button>

<hr>

<h3>Login</h3>
<input id="email" placeholder="Email">
<input id="password" type="password">
<button onclick="login()">Login</button>

<hr>

<h3>Create Post</h3>
<input id="title" placeholder="Post title">
<br><br>
<textarea id="content" placeholder="Post content"></textarea>
<br><br>
<button onclick="addPost()">Post</button>

<hr>

<h3>All Posts</h3>
<div id="posts"></div>

<script type="module">
  // ðŸ‘‘ ADMIN UID
  const ADMIN_UID = "ySYqhb67PlYQwagFye4mwulCG493";

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getAuth,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    getFirestore,
    collection,
    addDoc,
    getDocs,
    deleteDoc,
    doc,
    query,
    orderBy,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDYPJ4xZ8wx3KL7aVbji9A9KUWOYozKW-k",
    authDomain: "nextbook-78b81.firebaseapp.com",
    projectId: "nextbook-78b81",
    storageBucket: "nextbook-78b81.appspot.com",
    messagingSenderId: "1022007364860",
    appId: "1:1022007364860:web:884e9d153221494e575b79"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Signup
  window.signup = async () => {
    await createUserWithEmailAndPassword(
      auth,
      signupEmail.value,
      signupPassword.value
    );
    alert("Account created âœ…");
  };

  // Login
  window.login = async () => {
    await signInWithEmailAndPassword(
      auth,
      email.value,
      password.value
    );
    alert("Login success âœ…");
  };

  // Add Post
  window.addPost = async () => {
    if (!auth.currentUser) {
      alert("Login required");
      return;
    }

    await addDoc(collection(db, "posts"), {
      title: title.value,
      content: content.value,
      userId: auth.currentUser.uid,
      createdAt: serverTimestamp()
    });

    title.value = "";
    content.value = "";
    loadPosts();
  };

  // Delete Post (ADMIN ONLY)
  window.deletePost = async (postId) => {
    if (auth.currentUser.uid !== ADMIN_UID) {
      alert("Not allowed");
      return;
    }
    await deleteDoc(doc(db, "posts", postId));
    loadPosts();
  };

  // Load Posts
  async function loadPosts() {
    posts.innerHTML = "";
    const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
    const snap = await getDocs(q);

    snap.forEach(d => {
      const data = d.data();
      let html = `
        <h4>${data.title}</h4>
        <p>${data.content}</p>
      `;

      // ðŸ‘‘ Admin delete button
      if (auth.currentUser && auth.currentUser.uid === ADMIN_UID) {
        html += `<button onclick="deletePost('${d.id}')">ðŸ—‘ Delete</button>`;
      }

      html += `<hr>`;
      posts.innerHTML += html;
    });
  }

  // Auth check
  onAuthStateChanged(auth, user => {
    if (user) {
      if (user.uid === ADMIN_UID) {
        alert("Welcome Admin ðŸ‘‘");
      }
      loadPosts();
    }
  });
</script>

</body>
</html>
